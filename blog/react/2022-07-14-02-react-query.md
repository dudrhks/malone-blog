---
slug:  react-query
title: React Query ì‚¬ìš©í•˜ê¸°
authors: malone
tags: [React, Javascript, React Hook, React Query]
keywords: [react, react-hook, javscript, react query, query, ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ ì‚¬ìš©ë²•]
---
<br/>

# React Query ì‚¬ìš©í•˜ê¸°

[React Query](https://react-query.tanstack.com/)

# storeë€?

storeëŠ” ì „ì—­ ìƒíƒœê°€ ê´€ë¦¬ë˜ê³  ì €ì¥ë˜ê³  ê´€ë¦¬ë˜ëŠ” ê³µê°„ì´ë‹¤. front-end íŠ¹íˆ react ì—ì„œëŠ” Redux, Mobxì™€ ê°™ì€ ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤. ì‹¤ì œ front-end ê°œë°œë‹¨ì—ì„œëŠ” storeë¥¼ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ ë§ì´ ì‚¬ìš©í•œë‹¤. redux-saga, redux-thunk ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ì„œ ë§ì´ë‹¤.

storeì—ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ì½”ë“œ ë³´ë‹¤ apií†µì‹ ì„ ìœ„í•œ ì½”ë“œë¥¼ ë” ë§ì´ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ storeì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë° ê·¸ì— ë”°ë¼ í”„ë¡œì íŠ¸ê°€ ì»¤ì§ˆ ìˆ˜ ë¡ storeê°€ ì»¤ì ¸ê°€ê³  storeì— ì €ì¥ë˜ì–´ìˆëŠ” ì •ë³´ê°€ ì„œë²„ì™€ ì •ë³´ê°€ ë‹¤ë¥´ë‹¤. ì‚¬ìš©ì ëª¨ë¥´ê²Œ ë‹¤ë¥¸ì‚¬ëŒì´ storeì— ì ‘ê·¼í•´ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. ê°œë°œ ë‹¨ì—ì„œ storeì—ì„œ ì „ì—­ìƒíƒœ ê´€ë¦¬ì™€ api ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ë™ì‹œì— í•˜ë‹¤ë³´ë‹ˆ ë¬¸ì œê°€ ëŠê»´ì§€ê¸° ì‹œì‘í–ˆë‹¤

# React Query

React QueryëŠ” Server Stateë¥¼ ê´€ë¦¬í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ React í”„ë¡œì íŠ¸ì—ì„œ Serverì™€ Client ì‚¬ì´ ë¹„ë™ê¸° ë¡œì§ë“¤ì„ ì†ì‰½ê²Œ í•´ì¤€ë‹¤. ì•„ë˜ëŠ” ê³µì‹ í™ˆí˜ì´ì§€ì— React Queryì— ëŒ€í•œ ê°œìš”ì´ë‹¤.

<aside>
ğŸ’¡ React Query is often described as the missing data-fetching library for React, but in more technical terms, it makesÂ **fetching, caching, synchronizing and updating server state**Â in your React applications a breeze.

</aside>

ê³µì‹ í™ˆí˜ì´ì§€ì—ì„œëŠ” React Queryê°€ server stateì˜ ì—…ë°ì´íŠ¸, ë™ê¸°í™”, ìºì‹±, íŒ¨ì¹˜ë¥¼ ì§€ì›í•œë‹¤ê³  í•œë‹¤.

### Server Stateë€?

ì„œë²„ì—ì„œ ê°–ì˜¤ëŠ” ë°ì´í„°ë“¤ì˜ í•˜ë‚˜ì˜ ìƒíƒœ

ì„¸ì…˜ê°„ ì§€ì†ë˜ëŠ” ë°ì´í„°, ë¹„ë™ê¸°ì , ì„¸ì…˜ì„ ì§„í–‰í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ë§Œ ì†Œìœ í•˜ëŠ”ê²Œ ì•„ë‹ˆê³  ê³µìœ ë˜ëŠ” ë°ì´í„°ë„ ì¡´ì¬í•˜ë©° ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ì— ì˜í•´ ìˆ˜ì •ë  ìˆ˜ ìˆê¸°ì—, í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ ë°ì´í„°ì˜ ìŠ¤ëƒ…ìƒ·ë§Œì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ ë°ì´í„°ê°€ í•­ìƒ ìµœì‹ ì„ì„ ë³´ì¥ í•  ìˆ˜ ì—†ë‹¤

## ğŸ“Â  ì‚¬ìš©ë²•

ì—¬ê¸°ì„œëŠ” Next jsì—ì„œ ì„¤ì¹˜ë²•ì„ ì„¤ëª…í•œë‹¤

ì„¤ì¹˜

```jsx
yarn add react-query
```

### react query ì‹œì‘í•˜ê¸°

```jsx
//_app.tsx
import { QueryClient, QueryClientProvider, useQuery } from 'react-query'
 
 const queryClient = new QueryClient()
 
 export default function App() {
   return (
     <QueryClientProvider client={queryClient}>
       <Example />
     </QueryClientProvider>
   )
 }
 
 function Example() {
   const { isLoading, error, data } = useQuery('repoData', () =>
     fetch('https://api.github.com/repos/tannerlinsley/react-query').then(res =>
       res.json()
     )
   )
 
   if (isLoading) return 'Loading...'
 
   if (error) return 'An error has occurred: ' + error.message
 
   return (
     <div>
       <h1>{data.name}</h1>
       <p>{data.description}</p>
       <strong>ğŸ‘€ {data.subscribers_count}</strong>{' '}
       <strong>âœ¨ {data.stargazers_count}</strong>{' '}
       <strong>ğŸ´ {data.forks_count}</strong>
     </div>
   )
 }
```

### React Query ìƒíƒœ

1. fresh : ìµœì‹ ì˜ ì¿¼ë¦¬
2. fetching: ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” ì¿¼ë¦¬
3. stale: ì¸ìŠ¤í„´ìŠ¤ê°€ ì¡´ì¬í•˜ì§€ë§Œ ì´ë¯¸ íŒ¨ì¹­ì´ ì™„ë£Œëœ ì¿¼ë¦¬. íŠ¹ì • ì¿¼ë¦¬ê°€ staleëœ ìƒíƒœì—ì„œ ê°™ì€ ì¿¼ë¦¬ ë§ˆìš´íŠ¸ë¥¼ ì‹œë„í•œë‹¤ë©´ ìºì‹±ëœ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ë©´ì„œ ë¦¬íŒ¨ì¹­ì„ ì‹œë„
4. inactive: active ì¸ìŠ¤í„´ìŠ¤ê°€ í•˜ë‚˜ë„ ì—†ëŠ” ì¿¼ë¦¬, inactiveëœ ì´í›„ì—ë„ cacheTime ë™ì•ˆ ìºì‹œëœ ë°ì´í„°ê°€ ìœ ì§€ëœë‹¤.

### React query refetch

- ëŸ°íƒ€ì„ì— staleì¸ íŠ¹ì • ì¿¼ë¦¬ ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¤ì‹œ ë§Œë“¤ì–´ì¡Œì„ ë•Œ
- windowê°€ ë‹¤ì‹œ í¬ì»¤ìŠ¤ ë˜ì—ˆì„ë•Œ(on/off ê°€ëŠ¥ - refetchOnWindowFocus)
- ë„¤íŠ¸ì›Œí¬ê°€ ë‹¤ì‹œ ì—°ê²°ë˜ì—ˆì„ë•Œ(on/off ê°€ëŠ¥ - refetchOnReconnect)
- refetch intervalì´ ìˆì„ë•Œ: ìš”ì²­ ì‹¤íŒ¨í•œ ì¿¼ë¦¬ëŠ” ë””í´íŠ¸ë¡œ 3ë²ˆ ë” ë°±ê·¸ë¼ìš´ë‹¨ì—ì„œ ìš”ì²­í•˜ë©°, retry, retryDelay ì˜µì…˜ìœ¼ë¡œ ê°„ê²©ê³¼ íšŸìˆ˜ ì»¤ìŠ¤í…€ ê°€ëŠ¥í•˜ë‹¤

## âš™ï¸  queryClient setting

### ê¸°ë³¸ ì‚¬ìš©ë°©ë²•

app.js ì—ì„œ queryClientë¥¼ ì„¤ì •í•˜ê³  í•˜ê³  providerì— ì…‹íŒ… í•¨ ìœ¼ë¡œì„œ react queryë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤

```jsx
import { QueryClientProvider, QueryClient } from 'react-query';

function App(){
	const queryClient = new QueryClient({));

  return (
		<QueryClientProvider client={queryClient}>
			...
		</QueryClientProvider>
	)
}
```

### ì˜µì…˜ì„¤ì •

react query ì‚¬ìš©ì‹œì— ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©í•  ì˜µì…˜ë“¤ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤

[ğŸ”—Â query option](https://www.notion.so/query-option-c767b75bec684593852d9b661936c0f5)

```jsx
...
const queryClient = new QueryClient({
	defaultOptions: {
		// query ì˜µì…˜ ì„¤ì •
    queries: {
      enabled: false, // ìµœì´ˆ í˜¸ì¶œ ì‹œ í˜¸ì¶œ ì—¬ë¶€
      refetchOnMount: false, // ë°ì´í„°ê°€ stale ìƒíƒœì¼ ê²½ìš° ë§ˆìš´íŠ¸ ì‹œ ë§ˆë‹¤ refetch ì—¬ë¶€
      refetchOnReconnect: false, // ì¸í„°ë„·ì´ ëŠê²¼ë‹¤ê°€ ì—°ê²° ë  ë•Œ refetch ì—¬ë¶€
      refetchOnWindowFocus: false, // window focusingë  ë•Œ refetch ì—¬ë¶€
    },
		// mutation ì˜µì…˜ ì„¤ì •
    mutations: {
		   ...
    }
  }
));
...
```

### React quuery devtool

ê¸°ë³¸ì ìœ¼ë¡œ `process.env.NODE_ENV === 'developmentâ€™`  ìƒí™©ì—ì„œë§Œ ì‹¤í–‰ëœë‹¤

```tsx
// App.tsx
import { ReactQueryDevtools } from 'react-query/devtools';

function App() {
...
	<ReactQueryDevtools />
...
}
```

## âš™ï¸Â  Reqct Query Setting

### query key

- ìì„¸íˆ
    
    ### query key ìƒì„±
    
    - api í˜¸ì¶œ ì‹œ or data ì €ì¥ì‹œ param ê°’ì´ ì—†ë‹¤ë©´ keyí•˜ë‚˜ë§Œ ë‹¨ë… ì €ì¥
        
        ```jsx
        ...
        	 authorization: ['uesrAuthoriztion'] as const
        ...
        ```
        
    
    - api í˜¸ì¶œì‹œ prams ê°’ì´ ìˆì„ ë•ŒëŠ” query keyë¥¼ ì €ì¥í• ë•Œ, params ê°’ê³¼ key ëŒ€í‘œì´ë¦„ìœ¼ë¡œ í•¨ê»˜ ì§€ì •í•´ì¤€ë‹¤
        
        ```jsx
        ...
        summary: {
            all: ['summary'] as const,
        		// ['rankItems'] querykey ìƒì„±
        		// ['rankItems'] querykeyë¥¼ ê°€ì§€ê³  ìˆëŠ” ì „ì²´ data ì´ˆê¸°í™”ë“± ì‚­ì œê°€ ê°€ëŠ¥í•´ì§„ë‹¤
            rankItems: () => [...popularQueryKey.summary.all, 'rankItem'] as const,
        		// ['rankItems']ë¥¼ ê¸°ë³¸ìœ¼ë¡œ idê°’ì„ ì¶”ê°€í•˜ì—¬ í•´ë‹¹ id query keyë¥¼ ìƒì„±í•œë‹¤
            rankItem: (id: string) => [...popularQueryKey.summary.rankItems(), id] as const
        }
        ...
        ```
        
        ### query key ì „ì²´ ì½”ë“œ
        
        ```jsx
        export const authQueryKey = {
          authorization: ['uesrAuthoriztion'] as const
          all: ['summary'] as const,
          rankItems: () => [...popularQueryKey.summary.all, 'rankItem'] as const,
          rankItem: (id: string) => [...popularQueryKey.summary.rankItems(), id] as const
        };
        ```
        
    
    ### query keyëŠ”?
    
    - react queryëŠ” query keyì— ë”°ë¼ Dataë¥¼ ì €ì¥,ì¡°íšŒ, refresh í•  ìˆ˜ ìˆë‹¤.
    - query keyëŠ” useQueryë¥¼ ì´ìš©í•  ë•Œ í•„ìˆ˜ ì´ë‹¤
    - useMutationì—ì„œ í•„ìˆ˜ëŠ” ì•„ë‹ˆë‹¤
    - queryëŠ” stringì´ë‚˜ ë°°ì—´ë¡œ ì €ì¥í•  ìˆ˜ ìˆë‹¤

### query custom hook

<aside>
ğŸ’¡ ê°œì¸ì ìœ¼ë¡œëŠ” react query ì‚¬ìš©ì‹œì— custom hookì„ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•œë‹¤. ì•„ë˜ì˜ ë°©ë²•ì€ react-queryë¥¼ custom hookì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤

</aside>

- ìì„¸íˆ
    
    > queryë¬¸ ì•ˆì— ë“¤ì–´ê°€ëŠ” apiëŠ” axiosë¥¼ í†µí•´ì„œ ì‘ì„±í•˜ì˜€ë‹¤ ì•„ë˜ì˜ ë§í¬ë¥¼ ì°¸ê³ í•´ì„œ ì‘ì„±í•˜ë©´ëœë‹¤
    > 
    [https://malone-blog.vercel.app/axios-common-request](https://malone-blog.vercel.app/axios-common-request)
    
    ### useQuery
    
    - useQueryë¥¼ í˜¸ì¶œ ëœ ìˆœê°„ apië¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— ì²˜ìŒì— í˜¸ì¶œ í•˜ê³  ì‹¶ì§€ ì•Šìœ¼ë©´ enabled ì˜µì…˜ìœ¼ë¡œ í†µì œ í•  ìˆ˜ ìˆë‹¤
    - ì¿¼ë¦¬ëŠ” server stateë¥¼ ìš”ì²­í•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ì™€ í•¨ê»˜ unique keyë¡œ ë§¤í•‘
    - ì„œë²„ì— ë°ì´í„°ë¥¼ ë°”ê¾¸ëŠ” ìš”ì²­ì€ useMutaionì„ ì‚¬ìš©í•´ì•¼í•œë‹¤
    - Unique keyëŠ” í•œë²ˆ freshê°€ ë˜ì—ˆë‹¤ë©´ ê³„ì† ì¶”ì ì´ ê°€ëŠ¥í•˜ë‹¤. ë¦¬íŒ¨ì¹­, ìºì‹±, ê³µìœ ë“±ì„ í•  ë•Œ ì°¸ì¡°ë˜ëŠ” ê°’ì´ë‹¤.
    - ë°˜í™˜ê°’ìœ¼ë¡œ  ìš”ì²­ì˜ ê²°ê³¼ë‚˜ ì—ëŸ¬ê°’ì„ ë°˜í™˜í•œë‹¤
        - isLoading, isError, isSuccess, idIdle, status,
        - error, data, isFetching â‡’ ìš”ì²­ì´ í•œë²ˆì´ìƒ ë°œìƒí•˜ì˜€ë‹¤ë©´ ê°’ì„ ê°€ì§€ê³  ìˆë”°
    - statusê°’ì€ idle, loading, error, success, 4ê°€ì§€ì´ë‹¤. ê·¸ì¤‘ idleì€ ì¿¼ë¦¬ dataê°€ í•˜ë‚˜ë„ ì—†ê³  ë¹„ì—ˆì„ë–„, `{enable : false}` ìƒíƒœë¡œ ì¿¼ë¦¬ê°€ í˜¸ì¶œë˜ì—ˆì„ë•Œ ìƒíƒœë¥¼ ë§í•œë‹¤
    
    ```jsx
    // params ì—†ì„ ë•Œ
    export const useUserAuthorizationQuery = () => {
      const data = useQuery(authQueryKey.authorization, userInfoApi);
      return data;
    };
    
    // params ìˆì„ ë•Œ
    export const useRankItemQuery = (params: RankItemReq) => {
      const data = useQuery(
        popularQueryKey.summary.rankItem(params.commerceId),
        () => authApi.rankItem(params), // api
        { enabled: !params.commerceId } // íŠ¹ì •ì¡°ê±´ì´ ë§Œì¡±ë˜ê¸° ì „ê¹Œì§€ queryë¥¼ í˜¸ì¶œí•˜ê³  ì‹¶ì§€ ì•Šìœ¼ë©´ ì„¤ì •
      );
      return data;
    };
    ```
    
    ### useMutation
    
    - useMutationì€ ë°ì´í„°ë¥¼ ì¡°ì‘í•  ë•Œ methodì— ì‚¬ìš©í•˜ëŠ”ë° useQueryì™€ ë‹¬ë¦¬ mudateë¼ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œ í•˜ê¸° ì „ê¹Œì§€ëŠ” í˜¸ì¶œë˜ì—ˆë‹¤ í•˜ë”ë¼ë„ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤
    - ì„œë²„ì—ì„œ ë°ì´í„°ì˜ ìƒì„±/ìˆ˜ì •/ì‚­ì œ í•˜ì—¬ ì‚¬ì´ë“œ ì´í™íŠ¸ë¥¼ ì¼ìœ¼í‚¤ëŠ” ê²½ìš°ì—ëŠ” useMutationì„ ì‚¬ìš©í•œë‹¤
    - useMutationìœ¼ë¡œ mutaionê°ì²´ë¥¼ ì •ì˜í•˜ê³ , mutateë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ìš”ì²­ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ ìš”ì²­ì´ ë³´ë‚´ì§„ë‹¤.
    - mutation.reset : í˜„ì¬ì˜ errorì™€ dataë¥¼ ëª¨ë‘ ì§€ìš¸ ìˆ˜ ìˆë‹¤
    - ë‘ë²ˆì§¸ ì¸ìë¡œ ì½œë°± ê°ì²´ë¥¼ ë„˜ê²¨ì¤˜ì„œ ë¼ì´í”„ì‚¬ì´í´ ì¸í„°ì…‰íŠ¸ ë¡œì§ì„ ì§¤ ìˆ˜ë„ ìˆë‹¤.
    
    ```jsx
    export const useLoginQuery = () => {
      const queryClient = useQueryClient();
      const navigate = useNavigate();
      const data = useMutation<LoginRes, AxiosError, LoginReq>(authApi.login, {
    		 // ë®¤í…Œì´ì…˜ ì‹œì‘
       onMutate: variables => {
         // onMutateê°€ ë¦¬í„´í•˜ëŠ” ê°ì²´ëŠ” ì´í•˜ ìƒëª…ì£¼ê¸°ì—ì„œ context íŒŒë¼ë¯¸í„°ë¡œ ì°¸ì¡°ê°€ ê°€ëŠ¥í•˜ë‹¤.
         return { id: 1 }
       },
        // ì„±ê³µì‹œ ì´ë²¤íŠ¸
        onSuccess: (data) => {
          navigate('/home');
          // ì„±ê³µí–ˆì„ëŒ€ authorization ì •ë³´ ì—…ë°ì´íŠ¸
    			// querykeyë¥¼ í†µí•´ì„œ mutationìœ¼ë¡œ ë°›ì•„ì˜¨ dataì„ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
          queryClient.setQueryData(authQueryKey.authorization, data.user.authorization);
        },
    		// ì‹¤íŒ¨ í–ˆì„ ë•Œ ì´ë²¤íŠ¸
    		onError: (error) => {
          console.log(error);
        }
    		 // ì„±ê³µì´ë“  ì—ëŸ¬ë“  ì–´ì¨Œë“  ëë‚¬ì„ ë•Œ
    		onSettled: (data, error, variables, context) => {
    	  },
      });
      return data;
    };
    
    // ì‚¬ìš©ë²•
    const { mutate } = useLoginQuery(); // ì„ ì–¸
    mutate(); // api í˜¸ì¶œ
    ```
    
    ### useQueryClient
    
    - useQueryClient ëŠ” query keyë“±ì„ ì´ìš©í•´ keyë¥¼ ê°€ì§„ data ì ‘ê·¼í•˜ê±°ë‚˜ query ì˜µì…˜ ìˆ˜ì •ë“±ì„ í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤
    - ê¸°ë³¸ì ìœ¼ë¡œ useQueryClientë¥¼ í†µí•œ ì˜µì…˜ìœ¼ë¡œ custom hookì„ ë§Œë“¤ì–´ì„œ ì ‘ê·¼ì„ ê¶Œì¥
    
    ```tsx
    // rank item data ì ‘ê·¼
    export const useRankItemQueryClient = () => {
      const queryClient = useQueryClient();
      // rand item ì „ì²´ ì‚­ì œ
      const allRemove = useCallback(() => {
        queryClient.removeQueries(popularQueryKey.summary.rankItems());
      }, [queryClient]);
      // rand item ì „ì²´ ì´ˆê¸°í™”
      const allReset = useCallback(() => {
        queryClient.invalidateQueries(popularQueryKey.summary.rankItems());
      }, [queryClient]);
      // rankItem ê°œë³„ ì‚­ì œ
      const itemRemove = useCallback(
        (id: string) => {
          queryClient.removeQueries(popularQueryKey.summary.rankItem(id));
        },
        [queryClient]
      );
      // rankItem ì´ˆê¸°í™”
      const itemReset = useCallback(
        (id: string) => {
          queryClient.invalidateQueries(popularQueryKey.summary.rankItem(id));
        },
        [queryClient]
      );
      // rankItem data ì¡°íšŒ
      const data = useCallback(
        (id: string) => {
          queryClient.getQueryData(popularQueryKey.summary.rankItem(id));
        },
        [queryClient]
      );
    
      return { allRemove, allReset, itemRemove, itemReset, data };
    };
    ```
    
    ### useQueries
    
    - ì¶”í›„ì‘ì„±
    
    ### ****useInfiniteQuery****
    
    - ì¶”í›„ì‘ì„±

# ğŸ˜¨Â  ì—ëŸ¬ì²˜ë¦¬ ì„¤ê³„

- react query ì‚¬ìš©ì‹œ errorì²˜ë¦¬ë¥¼ ê³µí†µì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë¡œì§
- react query ì—ì„œëŠ” onError ì˜µì…˜ì„ í†µí•´ì„œ ì—ëŸ¬ í—¨ë“¤ë§ì„ í•  ìˆ˜ ìˆë‹¤.

## useApiError custom hooks

- query clientë¥¼ ìƒì„±í•  ë•Œ onErrorì˜µì…˜ì„ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì—ëŸ¬ë°œìƒì‹œ ì‚¬ìš©í•œë‹¤
- onErrorë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•˜ì—¬ useApiError ë¼ëŠ” ê¸°ë³¸ custom hookì„ ìƒì„±í•œë‹¤

### ê¸°ë³¸ ì‘ë™ ë°©ì‹

- useApiError ë¼ëŠ” custom hooks

```tsx

// í•¸ë“¤ëŸ¬ í•¨ìˆ˜
// 403ì—ëŸ¬ ì‘ì„±
const handler403 = () => {
  console.log('error 403');
};
// 401ì—ëŸ¬ ì‘ì„±
const handler401 = () => { 
  console.log('error 401');
};

// ê¸°ë³¸ í—¨ë“¤ëŸ¬
const defaultHandlers = {
  common: handlerCommon,
  default: handlerDefault,
  '401': handler401,
  '403': handler403
};

// custom hook í˜¸ì¶œ
const { handleError } = useApiError({
	409: {
		10001: errorHandler40910001,
	},
	500: {
		default: errorHandler500,
	},
});

// query í˜¸ì¶œ
const { isLoading, error, data, isFetching } = useQuery('key', fetchData, {
  onError: handleError,
});
```

### useApiError hook ìƒì„±

- ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  api í˜¸ì¶œì‹œ ë°˜ì‘í•  handlerë¥¼ ì œì‘í•œë‹¤
- ì¶”í›„ ê°œë³„ ê°ê°ì˜ query, mutation ì—ì„œ ê°œë³„ì ìœ¼ë¡œ í•„ìš”í•œ ì—ëŸ¬ í—¨ë“¤ë§ì˜ ê²½ìš°ë¥¼ ê³ ë ¤í•˜ì—¬ ê°œë³„ì ìœ¼ë¡œ ì‘ì„±í•œ errorí•¸ë“¤ë¦¬ì˜ ìš°ì„ ìˆœìœ„ê°€ ë†’ë„ë¡ êµ¬í˜„í•œë‹¤

> hooks/useApiError/index.ts
> 

```tsx

type DefaultHandlers = typeof defaultHandlers;
type HttpStatus = keyof DefaultHandlers;

// ê³µí†µ ì—ëŸ¬ í—¨ë“¤ëŸ¬
const handlerCommon = () => {
  console.log('error common');
};
// ì•„ë¬´í•´ë‹¹ ì—ëŸ¬ê°€ ì—†ì„ë•Œ
const handlerDefault = () => {
  console.log('error default');
};
// 401ì—ëŸ¬ ì‘ì„±
const handler401 = () => {
  console.log('error 401');
};
// 403ì—ëŸ¬ ì‘ì„±
const handler403 = () => {
  console.log('error 403');
};

// ê¸°ë³¸ í—¨ë“¤ëŸ¬ ì„¤ì •
const defaultHandlers = {
  common: handlerCommon,
  default: handlerDefault,
  '401': handler401,
  '403': handler403
};

// custom hook
const useApiError = (handlers: Partial<DefaultHandlers>) => {
	// handleError ì‘ì„±
  const handelError = useCallback(
    (error) => {
      const httpStatus: HttpStatus = error.status; // HTTP Status
      switch (true) {
        case handlers && _.hasIn(handlers, httpStatus):
          // ìš°ì„ ìˆœìœ„ 1. ì»´í¬ë„ŒíŠ¸ì—ì„œ (HTTP Status, ì„œë¹„ìŠ¤ í‘œì¤€ ì—ëŸ¬ Code) Key ì¡°í•©ìœ¼ë¡œ ì¬ì •ì˜í•œ í•¸ë“¤ëŸ¬
          handlers && handlers[httpStatus];
          break;
        case _.has(defaultHandlers, httpStatus):
          // ìš°ì„ ìˆœìœ„ 2. Hookì—ì„œ (HTTP Status, ì„œë¹„ìŠ¤ í‘œì¤€ ì—ëŸ¬ Code) Key ì¡°í•©ìœ¼ë¡œ ì •ì˜í•œ í•¸ë“¤ëŸ¬
          defaultHandlers[httpStatus];
          break;
        default:
          // ìš°ì„ ìˆœìœ„ 3. ì–´ë””ì—ì„œë„ ì •ì˜ë˜ì§€ ëª»í•œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬
          defaultHandlers.default();
      }
			// ì—ëŸ¬ë°œìƒì‹œ ê³µí†µìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” í•¸ë“¤ëŸ¬
      handlerCommon();
    },
    [handlers]
  );

  return { handelError };
};
```

### queryClient ì—ì„œ ê¸°ë³¸ì„¤ì •

```tsx
// App.tsx

function App(){
...
const { handelError } = useApiError({});
const queryClient = new QueryClient({
	defaultOptions: {
		queries: {
			onError:handelError
		},
		mutations: {
			onError:handelError
		}
	}
));
...
}

```

### react query custom hooksì—ì„œ ì„¤ì •

- í•´ë‹¹ ì¿¼ë¦¬ë¡œì§ ì—ëŸ¬ ì²˜ë¦¬ë§Œ ìˆ˜ì • í•˜ê³  ì‹¶ì„ë•Œ

```tsx
// queries/[auth].tsx

...
// ì›í•˜ëŠ” ì—ëŸ¬ ìƒí™©ì— handlerë§Œ ì¶”ê°€
const handler403 = () => {}
const loginErrorHandlers = {
  '403': handler403
};

...
export const useLoginQuery = () => {
	...
  const data = useMutation<LoginRes, AxiosError, LoginReq>(authApi.login, {
		...
    // ì—ëŸ¬ ì´ë²¤íŠ¸
    onError: (error) => {
      console.log(error);
    }
  });
  return data;
};
```

### ê°œë³„ ì»´í¬ë„ŒíŠ¸ ìƒí™©ì—ì„œ ìˆ˜ì •í•˜ê³  ì‹¶ì„ ë•Œ

```tsx
const handler403 = () => {}
const loginErrorHandlers = {
  '403': handler403
};

const Login = () => {
...
const {mutate} = useLoginQuery();

const fetchLogin = () => {
	mutate({
		onError: loginErrorHandlers
	})
}
...
}
```

# âœ¨Â option

## ğŸ”—Â query option

- ìì„¸íˆ
    
    ### **enabled (boolean)**
    
    - ì¿¼ë¦¬ê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ì—¬ë¶€ë¥¼ ê²°ì •í•˜ëŠ” ì˜µì…˜
    
    ### **retry (boolean | number | (failureCount: number, error: TError) => boolean)**
    
    - `retry`Â ëŠ” ì‹¤íŒ¨í•œ ì¿¼ë¦¬ë¥¼ ì¬ì‹œë„í•˜ëŠ” ì˜µì…˜ì´ë‹¤.
    - ê¸°ë³¸ì ìœ¼ë¡œ ì¿¼ë¦¬ ì‹¤íŒ¨ì‹œ 3ë²ˆ ì¬ì‹œë„ í•œë‹¤.
    - true ë¡œ ì„¤ì •í•˜ë©´ ì¿¼ë¦¬ ì‹¤íŒ¨ì‹œ ë¬´í•œ ì¬ì‹œë„í•˜ê³  falseë¡œ ì„¤ì •í•˜ë©´ ì¬ì‹œë„ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.
    
    ### **staleTime (number | Infinity)**
    
    - `staleTime`Â ì€ ë°ì´í„°ê°€Â `fresh`Â ìƒíƒœë¡œ ìœ ì§€ë˜ëŠ” ì‹œê°„ì´ë‹¤. í•´ë‹¹ ì‹œê°„ì´ ì§€ë‚˜ë©´Â `stale`Â ìƒíƒœê°€ ëœë‹¤.
    - default staleTimeì€ 0 ì´ë‹¤.
    - fresh ìƒíƒœì—ì„œëŠ” ì¿¼ë¦¬ê°€ ë‹¤ì‹œ mount ë˜ì–´ë„ fetchê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
    
    ### **cacheTime (number | Infinity)**
    
    - `cacheTime`Â ì€Â `inactive`Â ìƒíƒœì¸ ìºì‹œ ë°ì´í„°ê°€ ë©”ëª¨ë¦¬ì— ë‚¨ì•„ìˆëŠ” ì‹œê°„ì´ë‹¤. ì´ ì‹œê°„ì´ ì§€ë‚˜ë©´ ìºì‹œ ë°ì´í„°ëŠ” ê°€ë¹„ì§€ ì»¬ë ‰í„°ì— ì˜í•´ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°ëœë‹¤.
    - default cacheTime ì€ 5ë¶„ì´ë‹¤.
    
    ### **refetchOnMount (boolean | "always")**
    
    - `refetchOnMount`Â ëŠ” ë°ì´í„°ê°€Â **stale ìƒíƒœì¼ ê²½ìš°**Â ë§ˆìš´íŠ¸ ì‹œ ë§ˆë‹¤ refetchë¥¼ ì‹¤í–‰í•˜ëŠ” ì˜µì…˜ì´ë‹¤.
    - default true
    - always ë¡œ ì„¤ì •í•˜ë©´ ë§ˆìš´íŠ¸ ì‹œ ë§ˆë‹¤ ë§¤ë²ˆ refetch ë¥¼ ì‹¤í–‰í•œë‹¤.
    
    ### **refetchOnWindowFocus (boolean | "always")**
    
    - `refetchOnWindowFocus`Â ëŠ” ë°ì´í„°ê°€Â **stale ìƒíƒœì¼ ê²½ìš°**Â ìœˆë„ìš° í¬ì»¤ì‹± ë  ë•Œ ë§ˆë‹¤ refetchë¥¼ ì‹¤í–‰í•˜ëŠ” ì˜µì…˜ì´ë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´, í¬ë¡¬ì—ì„œ ë‹¤ë¥¸ íƒ­ì„ ëˆŒë €ë‹¤ê°€ ë‹¤ì‹œ ì›ë˜ ë³´ë˜ ì¤‘ì¸ íƒ­ì„ ëˆŒë €ì„ ë•Œë„ ì´ ê²½ìš°ì— í•´ë‹¹í•œë‹¤. ì‹¬ì§€ì–´ F12ë¡œ ê°œë°œì ë„êµ¬ ì°½ì„ ì¼œì„œ ë„¤íŠ¸ì›Œí¬ íƒ­ì´ë“ , ì½˜ì†” íƒ­ì´ë“  ê°œë°œì ë„êµ¬ ì°½ì—ì„œ ë†€ë‹¤ê°€ í˜ì´ì§€ ë‚´ë¶€ë¥¼ ë‹¤ì‹œ í´ë¦­í–ˆì„ ë•Œë„ ì´ ê²½ìš°ì— í•´ë‹¹í•œë‹¤.
    - default true
    - always ë¡œ ì„¤ì •í•˜ë©´ í•­ìƒ ìœˆë„ìš° í¬ì»¤ì‹± ë  ë•Œ ë§ˆë‹¤ refetchë¥¼ ì‹¤í–‰í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
    
    ### **onSuccess ((data: TDdata) => void)**
    
    - `onSuccess`Â ëŠ” ì¿¼ë¦¬ ì„±ê³µ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
    - ë§¤ê°œë³€ìˆ˜ dataëŠ” ì„±ê³µ ì‹œ ì„œë²„ì—ì„œ ë„˜ì–´ì˜¤ëŠ” response ê°’ì´ë‹¤.
    
    ### **onError ((error: TError) => void)**
    
    - `onError`Â ëŠ” ì¿¼ë¦¬ ì‹¤íŒ¨ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
    - ë§¤ê°œë³€ìˆ˜ë¡œ ì—ëŸ¬ ê°’ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.
    
    ### **onSettled ((data?: TData, error?: TError) => void)**
    
    - `onSettled`Â ëŠ” ì¿¼ë¦¬ê°€ ì„±ê³µí•´ì„œ ì„±ê³µí•œ ë°ì´í„°ê°€ ì „ë‹¬ë˜ê±°ë‚˜, ì‹¤íŒ¨í•´ì„œ ì—ëŸ¬ê°€ ì „ë‹¬ ë  ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
    - ë§¤ê°œë³€ìˆ˜ë¡œ ì„±ê³µ ì‹œì—” ì„±ê³µ ë°ì´í„°, ì‹¤íŒ¨ ì‹œì—ëŠ” ì—ëŸ¬ê°€ ì „ë‹¬ëœë‹¤.
    
    ### **initialData (TData | () => TData)**
    
    - `initialData`Â ë¥¼ ì„¤ì •í•˜ë©´ ì¿¼ë¦¬ ìºì‹œì˜ ì´ˆê¸° ë°ì´í„°ë¡œ ì‚¬ìš©ëœë‹¤. (ì¿¼ë¦¬ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ìºì‹œë˜ì§€ ì•Šì•˜ì„ ë•Œ)
    - staleTime ì´ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ì´ˆê¸° ë°ì´í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ stale ìƒíƒœë¡œ ê°„ì£¼í•œë‹¤.

## ğŸ”—Â mutation option

- ìì„¸íˆ
    
    ### onMutate: (variables: TVariables) => Promise<TContext | void> | TContext | void
    
    - `onMutate` ëŠ”
    
    ### **onSuccess ((data: TDdata) => void)**
    
    - `onSuccess`Â ëŠ” ì¿¼ë¦¬ ì„±ê³µ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
    - ë§¤ê°œë³€ìˆ˜ dataëŠ” ì„±ê³µ ì‹œ ì„œë²„ì—ì„œ ë„˜ì–´ì˜¤ëŠ” response ê°’ì´ë‹¤.
    
    ### **onError ((error: TError) => void)**
    
    - `onError`Â ëŠ” ì¿¼ë¦¬ ì‹¤íŒ¨ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
    - ë§¤ê°œë³€ìˆ˜ë¡œ ì—ëŸ¬ ê°’ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.
    
    ### **onSettled ((data?: TData, error?: TError) => void)**
    
    - `onSettled`Â ëŠ” ì¿¼ë¦¬ê°€ ì„±ê³µí•´ì„œ ì„±ê³µí•œ ë°ì´í„°ê°€ ì „ë‹¬ë˜ê±°ë‚˜, ì‹¤íŒ¨í•´ì„œ ì—ëŸ¬ê°€ ì „ë‹¬ ë  ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
    - ë§¤ê°œë³€ìˆ˜ë¡œ ì„±ê³µ ì‹œì—” ì„±ê³µ ë°ì´í„°, ì‹¤íŒ¨ ì‹œì—ëŠ” ì—ëŸ¬ê°€ ì „ë‹¬ëœë‹¤.
    
    ### **retry (boolean | number | (failureCount: number, error: TError) => boolean)**
    
    - `retry`Â ëŠ” ì‹¤íŒ¨í•œ ì¿¼ë¦¬ë¥¼ ì¬ì‹œë„í•˜ëŠ” ì˜µì…˜ì´ë‹¤.
    - ê¸°ë³¸ì ìœ¼ë¡œ ì¿¼ë¦¬ ì‹¤íŒ¨ì‹œ 3ë²ˆ ì¬ì‹œë„ í•œë‹¤.
    - true ë¡œ ì„¤ì •í•˜ë©´ ì¿¼ë¦¬ ì‹¤íŒ¨ì‹œ ë¬´í•œ ì¬ì‹œë„í•˜ê³  falseë¡œ ì„¤ì •í•˜ë©´ ì¬ì‹œë„ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.

# ì°¸ì¡°